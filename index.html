<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>SHASO</title>
<meta name="description" content="Just watch.">
<meta property="og:title" content="SHASO">
<meta property="og:description" content="Just watch.">
<meta property="og:image" content="https://paul13131313.github.io/shaso/public/ogp.png">
<meta property="og:url" content="https://paul13131313.github.io/shaso/">
<meta property="og:type" content="website">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="SHASO">
<meta name="twitter:description" content="Just watch.">
<meta name="twitter:image" content="https://paul13131313.github.io/shaso/public/ogp.png">
<link rel="icon" href="public/favicon.svg" type="image/svg+xml">
<style>
  @import url('https://fonts.googleapis.com/css2?family=DM+Mono:wght@300&display=swap');
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #0a0a0a;
    overflow: hidden;
    width: 100vw;
    height: 100vh;
    cursor: default;
    font-family: 'DM Mono', monospace;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
  }
  /* ── intro screen ── */
  #intro {
    position: fixed;
    inset: 0;
    z-index: 100;
    background: #0a0a0a;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    transition: opacity 1.5s ease, visibility 1.5s ease;
  }
  #intro.hide {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
  }
  #intro h1 {
    font-size: clamp(2rem, 8vw, 5rem);
    font-weight: 300;
    color: #e8e4df;
    letter-spacing: 0.4em;
    margin-bottom: 0.5em;
    opacity: 0;
    animation: fadeUp 2s ease forwards 0.5s;
  }
  #intro .start-hint {
    position: absolute;
    bottom: 15%;
    font-size: 0.75rem;
    color: #444;
    letter-spacing: 0.2em;
    opacity: 0;
    animation: fadeUp 2s ease forwards 2.5s;
    cursor: pointer;
  }
  #intro .start-hint::after {
    content: '';
    display: block;
    width: 1px;
    height: 30px;
    background: #333;
    margin: 12px auto 0;
    animation: pulse 2s ease infinite;
  }
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  @keyframes pulse {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 0.8; }
  }
  /* ── video ── */
  #video-container {
    position: fixed;
    inset: 0;
    z-index: 1;
    background: #0a0a0a;
  }
  #video-container iframe {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 100vw;
    height: 56.25vw; /* 16:9 */
    min-height: 100vh;
    min-width: 177.78vh; /* 16:9 */
    transform: translate(-50%, -50%);
    border: none;
    pointer-events: none;
  }
  /* ── window frame overlay ── */
  #window-frame {
    position: fixed;
    inset: 0;
    z-index: 10;
    pointer-events: none;
    box-shadow: inset 0 0 120px rgba(0,0,0,0.4);
  }
  #window-frame::before {
    content: '';
    position: absolute;
    inset: 3%;
    border: 1px solid rgba(255,255,255,0.03);
    border-radius: 8px;
  }
  /* ── reflection overlay ── */
  #reflection {
    position: fixed;
    inset: 0;
    z-index: 12;
    pointer-events: none;
    background: linear-gradient(
      165deg,
      transparent 0%,
      transparent 40%,
      rgba(255,255,255,0.008) 42%,
      transparent 44%,
      transparent 60%,
      rgba(255,255,255,0.005) 62%,
      transparent 64%,
      transparent 100%
    );
  }
  /* ── clickable area ── */
  #click-area {
    position: fixed;
    inset: 0;
    z-index: 20;
    cursor: default;
  }
  /* ── fullscreen button (top left) ── */
  #fullscreen-btn {
    position: fixed;
    top: 24px;
    left: 28px;
    z-index: 50;
    width: 24px;
    height: 24px;
    cursor: pointer;
    opacity: 0;
    transition: opacity 1.5s ease;
    padding: 2px;
  }
  #fullscreen-btn.show { opacity: 1; }
  #fullscreen-btn svg {
    width: 100%;
    height: 100%;
    stroke: rgba(255,255,255,0.45);
    stroke-width: 1.5;
    fill: none;
    transition: stroke 0.3s ease;
  }
  #fullscreen-btn:hover svg {
    stroke: rgba(255,255,255,0.7);
  }
  /* ── time (top right) ── */
  #time-display {
    position: fixed;
    top: 26px;
    right: 28px;
    z-index: 30;
    font-size: 0.75rem;
    color: rgba(255,255,255,0.45);
    letter-spacing: 0.15em;
    pointer-events: none;
    opacity: 0;
    transition: opacity 1.5s ease;
  }
  #time-display.show { opacity: 1; }
  /* ── route info (bottom left) ── */
  #route-info {
    position: fixed;
    bottom: 24px;
    left: 28px;
    z-index: 30;
    font-size: 0.7rem;
    color: rgba(255,255,255,0.45);
    letter-spacing: 0.1em;
    pointer-events: none;
    opacity: 0;
    transition: opacity 1.5s ease;
  }
  #route-info.show { opacity: 1; }
  /* ── change route button (bottom right) ── */
  #change-btn {
    position: fixed;
    bottom: 24px;
    right: 28px;
    z-index: 50;
    font-family: 'DM Mono', monospace;
    font-size: 0.7rem;
    color: rgba(255,255,255,0.45);
    letter-spacing: 0.15em;
    cursor: pointer;
    opacity: 0;
    transition: opacity 1.5s ease, color 0.3s ease;
    padding: 6px 14px;
  }
  #change-btn.show { opacity: 1; }
  #change-btn:hover {
    color: rgba(255,255,255,0.7);
  }
  /* ── mute toast ── */
  #mute-toast {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 40;
    font-size: 0.75rem;
    color: rgba(255,255,255,0.4);
    letter-spacing: 0.3em;
    opacity: 0;
    transition: opacity 0.5s ease;
    pointer-events: none;
  }
  #mute-toast.show { opacity: 1; }
  /* ── fade overlay for route transitions ── */
  #fade-overlay {
    position: fixed;
    inset: 0;
    z-index: 5;
    background: #0a0a0a;
    opacity: 0;
    pointer-events: none;
    transition: opacity 2s ease;
  }
  #fade-overlay.active {
    opacity: 1;
  }
</style>
</head>
<body>
<!-- intro -->
<div id="intro">
  <h1>SHASO</h1>
  <div class="start-hint" id="start-btn">tap to start</div>
</div>
<!-- main -->
<div id="video-container"></div>
<div id="window-frame"></div>
<div id="reflection"></div>
<div id="click-area"></div>
<div id="time-display"></div>
<div id="route-info"></div>
<div id="fullscreen-btn" title="fullscreen">
  <svg viewBox="0 0 20 20">
    <polyline points="1,7 1,1 7,1"/>
    <polyline points="13,1 19,1 19,7"/>
    <polyline points="19,13 19,19 13,19"/>
    <polyline points="7,19 1,19 1,13"/>
  </svg>
</div>
<div id="change-btn">next &gt;</div>
<div id="fade-overlay"></div>
<div id="mute-toast"></div>
<script>
// ─── config ───
const ROUTES = [
  // Switzerland
  { id: 'nKOe2PuERD0', name: 'Bernina Express — Switzerland', start: 600 },
  { id: 'Mw9qiV7XlFs', name: 'Bernina Pass, Autumn — Switzerland', start: 300 },
  { id: 'tnUxvl7gZOw', name: 'Albula Line — Switzerland', start: 305 },
  // Norway
  { id: 'eQo60OoYAJ0', name: 'Bergen Railway — Norway', start: 600 },
  { id: 'M17BPhDrKg0', name: 'Dark Season Morning — Norway', start: 50 },
  { id: 'Q1IdDco_MFE', name: 'November Sunrise — Norway', start: 165 },
  // Scotland
  { id: 'oHrnBcYW6U0', name: 'West Highland Line — Scotland', start: 35 },
  // Austria
  { id: 'QXGTzbPaF1w', name: 'Brenner Pass, Snow — Austria', start: 55 },
  // Sri Lanka
  { id: 'hxITmHjOD-w', name: 'Kandy to Ella — Sri Lanka', start: 250 },
  // Japan
  { id: 'kKF5wGR8Luc', name: 'Riverside Gifu — Japan', start: 100 },
  { id: 'eCE4hYw8AAI', name: 'Tokyo Bay Twilight — Japan', start: 50 },
  { id: 'WKF6roEDPvI', name: 'Green Summer Nagano — Japan', start: 100 },
  { id: 'X7tEnT5eizQ', name: 'San\'in Coastline — Japan', start: 40 },
];
// shuffle queue so every route plays once before repeating
let routeQueue = [];
function getNextRoute() {
  if (routeQueue.length === 0) {
    routeQueue = [...ROUTES];
    // Fisher-Yates shuffle
    for (let i = routeQueue.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [routeQueue[i], routeQueue[j]] = [routeQueue[j], routeQueue[i]];
    }
    // avoid same route back-to-back across cycles
    if (currentRoute && routeQueue[0].id === currentRoute.id && routeQueue.length > 1) {
      [routeQueue[0], routeQueue[routeQueue.length - 1]] = [routeQueue[routeQueue.length - 1], routeQueue[0]];
    }
  }
  return routeQueue.shift();
}
let audioCtx, isMuted = false, gatanInterval;
let currentRoute, bgmAudio;
// ─── init ───
document.getElementById('start-btn').addEventListener('click', start);
document.getElementById('intro').addEventListener('click', start);
function start() {
  document.getElementById('intro').classList.add('hide');
  initBGM();
  initAudio();
  initVideo();
  updateTime();
  setInterval(updateTime, 60000);
  // show UI after a beat
  setTimeout(() => {
    document.getElementById('time-display').classList.add('show');
    document.getElementById('route-info').classList.add('show');
    document.getElementById('fullscreen-btn').classList.add('show');
    document.getElementById('change-btn').classList.add('show');
  }, 2000);
}
// ─── bgm with crossfade loop ───
const BGM_VOL = 0.3;
const FADE_DUR = 3; // seconds
function initBGM() {
  bgmAudio = new Audio('public/bgm.mp3');
  bgmAudio.volume = 0;
  bgmAudio.play().catch(() => {});
  // fade in on start
  fadeAudio(bgmAudio, 0, isMuted ? 0 : BGM_VOL, FADE_DUR);
  // crossfade before end
  bgmAudio.addEventListener('loadedmetadata', () => {
    scheduleCrossfade();
  });
  // fallback if metadata already loaded
  if (bgmAudio.duration) scheduleCrossfade();
}
function scheduleCrossfade() {
  const checkInterval = setInterval(() => {
    if (!bgmAudio || bgmAudio.paused) return;
    const remaining = bgmAudio.duration - bgmAudio.currentTime;
    if (remaining <= FADE_DUR + 0.1) {
      clearInterval(checkInterval);
      // fade out current
      fadeAudio(bgmAudio, bgmAudio.volume, 0, FADE_DUR);
      // start next copy with fade in
      const next = new Audio('public/bgm.mp3');
      next.volume = 0;
      next.play().catch(() => {});
      fadeAudio(next, 0, isMuted ? 0 : BGM_VOL, FADE_DUR);
      next.addEventListener('loadedmetadata', () => {
        bgmAudio = next;
        scheduleCrossfade();
      });
      if (next.duration) {
        bgmAudio = next;
        scheduleCrossfade();
      }
    }
  }, 500);
}
function fadeAudio(audio, from, to, dur) {
  const steps = 30;
  const interval = (dur * 1000) / steps;
  const delta = (to - from) / steps;
  let step = 0;
  audio.volume = from;
  const timer = setInterval(() => {
    step++;
    audio.volume = Math.max(0, Math.min(1, from + delta * step));
    if (step >= steps) clearInterval(timer);
  }, interval);
}
// ─── audio: synthesized gatangoton ───
function initAudio() {
  audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  // master gain
  const master = audioCtx.createGain();
  master.gain.value = 0.35;
  master.connect(audioCtx.destination);
  // continuous rumble (brown noise)
  const rumbleSize = audioCtx.sampleRate * 4;
  const rumbleBuffer = audioCtx.createBuffer(2, rumbleSize, audioCtx.sampleRate);
  for (let ch = 0; ch < 2; ch++) {
    const data = rumbleBuffer.getChannelData(ch);
    let last = 0;
    for (let i = 0; i < rumbleSize; i++) {
      const white = Math.random() * 2 - 1;
      data[i] = (last + (0.02 * white)) / 1.02;
      last = data[i];
      data[i] *= 3.5;
    }
  }
  const rumble = audioCtx.createBufferSource();
  rumble.buffer = rumbleBuffer;
  rumble.loop = true;
  const rumbleFilter = audioCtx.createBiquadFilter();
  rumbleFilter.type = 'lowpass';
  rumbleFilter.frequency.value = 120;
  const rumbleGain = audioCtx.createGain();
  rumbleGain.gain.value = 0.6;
  rumble.connect(rumbleFilter);
  rumbleFilter.connect(rumbleGain);
  rumbleGain.connect(master);
  rumble.start();
  // rail joint clicks (gatangoton)
  function playClick(time, vol, pitch) {
    const dur = 0.06;
    const buf = audioCtx.createBuffer(1, audioCtx.sampleRate * dur, audioCtx.sampleRate);
    const d = buf.getChannelData(0);
    for (let i = 0; i < d.length; i++) {
      const t = i / audioCtx.sampleRate;
      d[i] = (Math.random() * 2 - 1) * Math.exp(-t * 60) * vol;
    }
    const src = audioCtx.createBufferSource();
    src.buffer = buf;
    const filter = audioCtx.createBiquadFilter();
    filter.type = 'bandpass';
    filter.frequency.value = pitch;
    filter.Q.value = 2;
    const gain = audioCtx.createGain();
    gain.gain.value = vol;
    src.connect(filter);
    filter.connect(gain);
    gain.connect(master);
    src.start(time);
  }
  // schedule gatangoton rhythm
  function scheduleGatan() {
    const now = audioCtx.currentTime;
    const cycle = 1.6 + Math.random() * 0.15;
    playClick(now, 0.4, 300);
    playClick(now + 0.12, 0.7, 250);
    playClick(now + cycle * 0.5, 0.35, 320);
    playClick(now + cycle * 0.5 + 0.12, 0.65, 230);
    gatanInterval = setTimeout(scheduleGatan, cycle * 1000);
  }
  scheduleGatan();
  // subtle wind
  const windSize = audioCtx.sampleRate * 6;
  const windBuffer = audioCtx.createBuffer(2, windSize, audioCtx.sampleRate);
  for (let ch = 0; ch < 2; ch++) {
    const data = windBuffer.getChannelData(ch);
    for (let i = 0; i < windSize; i++) {
      data[i] = (Math.random() * 2 - 1);
    }
  }
  const wind = audioCtx.createBufferSource();
  wind.buffer = windBuffer;
  wind.loop = true;
  const windFilter = audioCtx.createBiquadFilter();
  windFilter.type = 'bandpass';
  windFilter.frequency.value = 800;
  windFilter.Q.value = 0.5;
  const windGain = audioCtx.createGain();
  windGain.gain.value = 0.04;
  wind.connect(windFilter);
  windFilter.connect(windGain);
  windGain.connect(master);
  wind.start();
  window._audioMaster = master;
}
// ─── video ───
function initVideo() {
  currentRoute = getNextRoute();
  const container = document.getElementById('video-container');
  container.innerHTML = `<iframe
    src="https://www.youtube.com/embed/${currentRoute.id}?autoplay=1&mute=1&controls=0&showinfo=0&rel=0&loop=1&playlist=${currentRoute.id}&start=${currentRoute.start}&modestbranding=1&iv_load_policy=3&disablekb=1&fs=0&playsinline=1"
    allow="autoplay; encrypted-media"
    allowfullscreen
  ></iframe>`;
  document.getElementById('route-info').textContent = currentRoute.name;
}
// ─── mute toggle ───
document.getElementById('click-area').addEventListener('click', () => {
  if (!audioCtx) return;
  isMuted = !isMuted;
  const toast = document.getElementById('mute-toast');
  if (isMuted) {
    window._audioMaster.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.5);
    if (bgmAudio) fadeAudio(bgmAudio, bgmAudio.volume, 0, 0.5);
    toast.textContent = 'SOUND OFF';
  } else {
    window._audioMaster.gain.linearRampToValueAtTime(0.35, audioCtx.currentTime + 0.5);
    if (bgmAudio) fadeAudio(bgmAudio, bgmAudio.volume, BGM_VOL, 0.5);
    toast.textContent = 'SOUND ON';
  }
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 1500);
});
// ─── time ───
function updateTime() {
  const now = new Date();
  const h = String(now.getHours()).padStart(2, '0');
  const m = String(now.getMinutes()).padStart(2, '0');
  document.getElementById('time-display').textContent = `${h}:${m}`;
}
// ─── change route with fade ───
let isChanging = false;
document.getElementById('change-btn').addEventListener('click', (e) => {
  e.stopPropagation();
  if (isChanging) return;
  isChanging = true;
  const fade = document.getElementById('fade-overlay');
  fade.classList.add('active');
  setTimeout(() => {
    currentRoute = getNextRoute();
    const container = document.getElementById('video-container');
    container.innerHTML = `<iframe
      src="https://www.youtube.com/embed/${currentRoute.id}?autoplay=1&mute=1&controls=0&showinfo=0&rel=0&loop=1&playlist=${currentRoute.id}&start=${currentRoute.start}&modestbranding=1&iv_load_policy=3&disablekb=1&fs=0&playsinline=1"
      allow="autoplay; encrypted-media"
      allowfullscreen
    ></iframe>`;
    document.getElementById('route-info').textContent = currentRoute.name;
    setTimeout(() => {
      fade.classList.remove('active');
      isChanging = false;
    }, 2500);
  }, 2000);
});
// ─── fullscreen ───
document.getElementById('fullscreen-btn').addEventListener('click', (e) => {
  e.stopPropagation();
  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().catch(() => {});
  } else {
    document.exitFullscreen();
  }
});
// ─── keyboard shortcuts ───
document.addEventListener('keydown', (e) => {
  // F key: toggle fullscreen
  if (e.key === 'f' || e.key === 'F') {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen().catch(() => {});
    } else {
      document.exitFullscreen();
    }
  }
  // N key or right arrow: next route
  if (e.key === 'n' || e.key === 'N' || e.key === 'ArrowRight') {
    document.getElementById('change-btn').click();
  }
  // M key: mute toggle
  if (e.key === 'm' || e.key === 'M') {
    document.getElementById('click-area').click();
  }
});
</script>
</body>
</html>